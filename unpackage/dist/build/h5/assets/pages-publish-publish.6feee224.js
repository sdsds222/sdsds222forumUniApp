import{g as t,z as e,C as s,r as n,D as a,o as l,c as i,w as o,i as r,d as c,u,k as d,t as h,I as p,E as g,G as m,H as f}from"./index-94c27637.js";import{p as k}from"./jwt.dd2c00ad.js";import{h as I}from"./host.9c9b05ea.js";import{_}from"./_plugin-vue_export-helper.1b428a4d.js";const w=_({data:()=>({title:"",classId:0,classOptions:[],content:"",picurl:"",navArr:[],author:"",jwtToken:"",information:'使用<img src="图片链接">文本添加图片，\n使用<br/>文本换行,\n使用<center>居中内容<center/>方式来居中'}),onShow(){this.navArr=[],this.classOptions=[],this.jwtToken=t("jwt-token"),""!=this.jwtToken?this.author=k(this.jwtToken).username:(e({title:"用户未登录",icon:"loading",duration:1e3}),s({url:"/pages/login/login"})),n({url:I+"/uniapp/navlist",success:t=>{this.navArr=t.data.data;for(let e=0;e<this.navArr.length;e++)this.classOptions.push(this.navArr[e].classname)}})},methods:{publish(){""!=this.title&&""!=this.content&&""!=this.author?n({url:I+"/uniapp/publish",method:"POST",header:{token:this.jwtToken},data:{title:this.title,cid:this.classId+1,content:this.content,picurl:""==this.picurl?"error":this.picurl,author:this.author},success:t=>{console.log("请求成功",t.data),"NOT_LOGIN"==t.data.msg?(e({title:"用户未登录,发布失败",icon:"loading",duration:1e3}),s({url:"/pages/login/login"})):e({title:"操作成功",icon:"success",duration:1e3})},fail:t=>{console.error("请求失败",t),e({title:"操作失败",icon:"loading",duration:1e3})}}):a({title:"发布失败",content:"标题、用户名、富文本内容为空，无法发送。",success:t=>{t.confirm||t.cancel}})},handlePickerChange(t){this.classId=t.detail.value},updateContent(t){this.content=t.detail.text},insertImage(){this.editorContext.insertImage({src:this.imageUrl,width:"100%"})},updateUrl(t){this.picurl=t.detail.text,this.picurl=this.picurl.replace(/(\r\n|\r|\n)/g,"")}}},[["render",function(t,e,s,n,a,k){const I=p,_=g,w=r,j=m,v=f;return l(),i(w,{class:"publish-content"},{default:o((()=>[c(w,{class:"container"},{default:o((()=>[u("p",null,"标题："),c(I,{modelValue:a.title,"onUpdate:modelValue":e[0]||(e[0]=t=>a.title=t),type:"text",placeholder:"请输入标题"},null,8,["modelValue"]),u("p",null,"封面图床外链url："),c(w,{class:"url-editor-view"},{default:o((()=>[c(_,{class:"url-editor",onInput:k.updateUrl,type:"text",placeholder:"请输入封面图片的链接url"},null,8,["onInput"])])),_:1}),u("p",null,"要发布到的分区板块："),c(j,{onChange:k.handlePickerChange,mode:"selector",range:a.classOptions},{default:o((()=>[c(w,{class:"picker"},{default:o((()=>[d(h(a.classOptions[a.classId]),1)])),_:1})])),_:1},8,["onChange","range"]),u("p",null,"富文本内容："),c(w,{class:"editor"},{default:o((()=>[c(_,{class:"content-editor",onInput:k.updateContent,"show-img-size":!0,content:a.content,placeholder:"在此区域输入文本内容\n"+a.information},null,8,["onInput","content","placeholder"])])),_:1})])),_:1}),u("p",{style:{margin:"30rpx"}},h(a.information),1),c(v,{onClick:k.publish,class:"publish-button"},{default:o((()=>[d("发布")])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-f26cff0c"]]);export{w as default};
